define(['exports', 'preact/jsx-runtime', 'preact/hooks', './utils/UNSAFE_classNames', './utils/UNSAFE_mergeProps', './utils/UNSAFE_keys', './PRIVATE_LoadMoreCollection', './PRIVATE_VirtualizedCollection', 'preact/compat', './hooks/UNSAFE_useTabbableMode', './UNSAFE_FocusTrap', './hooks/UNSAFE_useId', './hooks/UNSAFE_useInteractionStyle', './utils/UNSAFE_mergeInterpolations', './utils/UNSAFE_interpolations/flexitem', './PRIVATE_List/themes/ListStyles.css', './classNames-bd4a4c19', './flexitem-70c06ae3', './FocusTrap-47f31a06', './hooks/PRIVATE_useSelection', './hooks/PRIVATE_useCurrentKey', './hooks/PRIVATE_useCollectionFocusRing', './hooks/PRIVATE_useTabbableModeSet', './hooks/PRIVATE_useItemAction', './SkeletonContainer-9733c82c', './UNSAFE_Skeleton', './UNSAFE_Flex', './utils/PRIVATE_collectionUtils', './UNSAFE_Selector', './hooks/PRIVATE_useCollectionGestureContext', './VirtualizedCollection-1ded33d9', './LoadMoreCollection-03bfa7e9', './Flex-cc4e4675', './Skeleton-c9a7cd89'], (function(e,t,i,s,o,n,l,a,r,c,u,d,f,g,b,m,y,S,x,v,h,p,k,A,E,C,F,I,T,V,R,P,j,w){"use strict";const _=e=>{switch(e){case"listbox":return{list:"listbox",item:"presentation",cell:"option"};case"treegrid":return{list:"treegrid",item:"row",cell:"gridcell"};default:return{list:"grid",item:"row",cell:"gridcell"}}},N="oj-c-listview-item",M="."+N;function K({children:e,context:s,itemDepth:o,isFocused:n,isFocusRingVisible:l,isActive:a,isGridlineVisible:r,isSelected:u,isTopGridlineVisible:b=!1,isTabbable:v=!1,role:h,selectionMode:p,suggestion:k,currentItemVariant:A}){const E=i.useRef(null),C=i.useMemo((()=>_(h)),[h]),F=s.metadata.key,I=s.index,T="option"===C.cell?{role:C.cell,"aria-posinset":I+1,"aria-setsize":-1}:{role:C.cell},{interactionProps:V,applyActiveStyle:R,applyHoverStyle:P,applyPseudoHoverStyle:j}=f.useInteractionStyle(),w=m.listItemMultiVariantStyles({selectable:L(p,u)?"isSelectable":"notSelectable",selected:u?"isSelected":"notSelected",selectedSingle:u&&"single"===p?"isSelectedSingle":"notSelectedSingle",needsEventsHover:P?"isNeedsEventsHover":"notNeedsEventsHover",pseudoHover:j?"isPseudoHover":"notPseudoHover",active:R||a?"isActive":"notActive",focusHighlight:"highlight"===A&&n?"isFocusHighlight":"notFocusHighlight",focusRingVisible:l&&n?"isFocusRingVisible":"notFocusRingVisible",gridlineTop:b?"visible":"hidden",gridlineBottom:!r&&("end"!==k||r||u&&"single"===p)?"hidden":"visible"}),M=y.classNames([N,w]),K=g.mergeInterpolations([...Object.values(S.flexitemInterpolations)]),{class:z,...H}=K({flex:"1 1 auto",alignSelf:"center"}),U=y.classNames([z,"multiple"===p&&m.listItemStyles.checkboxContainer]);return t.jsx("div",{"aria-rowindex":I+1,"aria-level":o,"data-oj-key":F,class:M,ref:E,role:C.item,...k&&{"data-oj-suggestion":!0},..."number"==typeof F&&{"data-oj-key-type":"number"},...V,children:t.jsx("div",{id:d.useId(),style:H,class:U,"aria-posinset":I+1,"aria-setsize":-1,onKeyDown:e=>{!v||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.stopPropagation()},"aria-colindex":1,"aria-selected":"none"!==p?u:void 0,...T,children:t.jsx(c.TabbableModeContext.Provider,{value:{isTabbable:v},children:t.jsx(x.FocusTrap,{isDisabled:!v,restoreFocusRef:!1,children:e(s)})})})})}const L=(e,t)=>"none"!==e&&("multiple"===e||!t),z=r.memo(K,((e,t)=>!(!e||!t)&&(e.children===t.children&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.isTabbable===t.isTabbable&&e.isActive===t.isActive&&e.suggestion===t.suggestion&&H(e.context,t.context)))),H=(e,t)=>e.data===t.data&&e.index===t.index&&e.isSelected===t.isSelected&&e.metadata.key===t.metadata.key;const U="oj-collection-sparkle";function D({sparkleHeight:e}){if(e<=0)return null;const i=e+"px",s=y.classNames([m.sparkleStyles.base]),o=y.classNames([m.sparkleStyles.container,U]);return t.jsx("div",{class:o,children:t.jsx("div",{class:s,style:{height:i}})},"sparkle")}const O=e=>!(!e.parentElement||!e.parentElement.classList.contains("oj-listview-expander")),G=(e,t,i)=>{if(e&&t&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"}),i>0)){const s=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=s.top+i-o.top;n>0&&(t.scrollTop=t.scrollTop-n)}},B=(e,t)=>t??{scroller:()=>e.current},q={all:!1,keys:new Set},Y=(e,t)=>{const i=t.data.map((e=>e.metadata.key)),s=i.indexOf(e.value.start),o=i.indexOf(e.value.end),n=Math.min(s,o),l=Math.max(s,o);return-1===n?{offset:0,count:t.totalSize}:i.slice(n,l+1)},$=t.jsx(E.SkeletonContainer,{minimumCount:25,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})}),J=t.jsx("div",{class:P.LOADMORE_STYLE_CLASS,children:t.jsx(E.SkeletonContainer,{minimumCount:3,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})})}),Q=(e,t)=>{if(t){const i=Math.min(t.offset,e.offset+e.totalSize),s=i-e.offset;s>0&&(e={offset:i,data:e.data.slice(s,s+t.count),totalSize:e.totalSize,sizePrecision:e.sizePrecision})}return e};e.ITEM_STYLE_CLASS=N,e.List=function({"aria-label":e,"aria-labelledby":s,allowTabbableMode:l=!0,children:a,currentKey:r,data:c,gridlines:u,loadingIndicator:d=$,onCurrentKeyChange:f,onLoadRange:g,onSelectionChange:b,onItemAction:S,rangeExtractor:x,role:E="grid",selectedKeys:C=q,selectionMode:F="none",viewportConfig:j,currentItemVariant:w="none",promotedSection:N,isVirtualized:L=!0,customItemRenderer:H,eventHandlers:U,scrollToVisibleOffset:W}){const X=i.useRef(null),Z=i.useMemo((()=>_(E)),[E]),ee=i.useRef(),te=i.useRef(),ie=i.useRef(),[se,oe]=i.useState(!1),[ne,le]=i.useState(0),ae="none"===F?void 0:"multiple"===F,re=null===c?void 0:"exact"===c.sizePrecision?c.totalSize:-1,ce=y.classNames([m.listStyles.base]);!function(e,t,s){const o=i.useRef();i.useEffect((()=>{const i=o.current;if(t&&s&&i&&e&&i.offset===e.offset&&i!==e){const o=e.data.map((e=>e.metadata.key));if(-1===o.indexOf(t)){const e=i?.data.map((e=>e.metadata.key));let n=e.indexOf(t);if(n>-1){const t=n===e.length-1;for(;n>=0&&n<e.length;){n=t?n-1:n+1;const i=e[n];if(o.indexOf(i)>-1){s({value:i});break}}}}}o.current=e}),[e,t,s])}(c,r,f);const{currentKeyProps:ue}=h.useCurrentKey((e=>I.keyExtractor(e,M)),"multiple"!==F,I.getPrevNextKey(X.current,r,!0,M),I.getPrevNextKey(X.current,r,!1,M),void 0,void 0,r,f),de=e=>!!X.current?.contains(e),[fe,ge]=p.useCollectionFocusRing(de,["ArrowUp","ArrowDown"]);let be=!1;const[me,ye]=k.useTabbableModeSet(de,(e=>O(e)?null:I.keyExtractor(e,M)),r,((e,t)=>{de(e)&&(t?(be=!0,setTimeout((()=>{X.current?.focus()}),0)):X.current?.focus())}),(e=>{f&&f({value:e})}));i.useEffect((()=>{if(null!=r&&X.current){const e=I.findElementByKey(X.current,r,M);if(e){const t=X.current.getAttribute("aria-activedescendant"),i=e.querySelector(`[role=${Z.cell}]`);if(i&&t!==i.id){X.current.setAttribute("aria-activedescendant",i.id);const t=j?.scroller(),s=W?W(X.current):0;G(e,null!=t?t:X.current,s)}}}}),[r,c,Z.cell,j]);const Se=i.useCallback((e=>{b&&(!1===e.value.all&&e.value.keys.size>0&&(ee.current=Array.from(e.value.keys.values()).pop()),b(e))}),[ee,b]),xe=i.useCallback((e=>{if(c&&b){const t=Y(e,c);Array.isArray(t)?b({value:{all:!1,keys:new Set(t)},target:null}):(te.current={detail:e,range:{offset:c.offset,count:c.data.length}},g(t))}}),[c,b,g]),ve=i.useCallback((()=>{if(X.current&&f&&(!l||me(void 0))){const e=ie.current||I.getFirstVisibleKey(X.current,M);n.isKeyDefined(e)&&f({value:e})}}),[l,f,me]),he=i.useCallback((e=>{const t=I.keyExtractor(e.target,M);t&&"checkbox"===e.relatedTarget?.getAttribute("type")&&(X.current?.focus(),f&&t&&f({value:t}))}),[f]),pe=i.useCallback((e=>{if(O(e.target)){X.current?.focus();const t=I.keyExtractor(e.target,M);f&&t&&f({value:t})}else!n.isKeyDefined(r)&&f&&ve(),!l&&he(e)}),[l,r,ve,he,f]),ke=V.useCollectionGestureContext(),{selectionProps:Ae}=v.useSelection((e=>e===X.current?void 0===r?null:r:I.keyExtractor(e,M)),C,F,!1,"replace","embedded"===ke,Se,ee.current,r,((e,t)=>I.getPrevNextKey(X.current,e,t,M)),void 0,(e=>{if(X.current){const t=I.findElementByKey(X.current,e,M);if(t){const e=j?.scroller(),i=W?W(X.current):0;G(t,null!=e?e:X.current,i)}}}),xe);if(c&&void 0!==te.current&&b){const e=Y(te.current.detail,c);Array.isArray(e)&&b({value:{all:!1,keys:new Set(e)},target:null});const t=te.current?te.current.range:{offset:c.offset,count:c.data.length};c=Q(c,t),te.current=void 0,g(t)}const Ee=i.useMemo((()=>c&&N&&((e,t)=>0===t?null:e.slice(0,t).reduce(((e,i,s)=>{const o=i.metadata.key;return s===t-1?e.set(o,"end"):e.set(o,!0),e}),new Map))(c.data,N.count)),[c,N]),Ce=t.jsx(D,{sparkleHeight:ne}),Fe=A.useItemAction(r,c,S,M,"embedded"===ke);i.useEffect((()=>{if(Ee){const e=X.current?.querySelector("."+R.PLACEHOLDER_STYLE_CLASS);let t=e?.offsetHeight||0;const i=X.current?.querySelectorAll("[data-oj-suggestion]");i?.forEach((e=>t+=e.offsetHeight)),le(t)}}),[Ee]);const Ie=i.useCallback((e=>{const i="multiple"===F?()=>t.jsx(T.Selector,{onChange:Se,rowKey:e.data.metadata.key,selectedKeys:C}):void 0;return{index:e.index,data:e.data.data,metadata:e.data.metadata,selector:i}}),[F,C,Se]),Te=L?K:z,Ve=e=>{const i=Ie(e),s=Ee?.get(i.metadata.key),o=l&&me(i.metadata.key),d=r===i.metadata.key&&!o,f=d&&se,g=n.containsKey(C,i.metadata.key),b=d&&fe&&!be,m=(e,o)=>{return t.jsx(Te,{context:e,isFocused:d,isFocusRingVisible:b,isActive:f,isGridlineVisible:(n=i.index,"visible"===u?.item&&(n+1!==c?.totalSize||"visible"===u?.bottom)),isSelected:g,isTabbable:l&&me(i.metadata.key),role:E,selectionMode:F,currentItemVariant:w,...s&&{suggestion:s},...0===i.index&&{isTopGridlineVisible:"visible"===u?.item&&"visible"===u?.top},...o,children:a},i.metadata.key);var n};if(H){return H({listItemContext:i,isFocused:d,isFocusRingVisible:b,isSelected:g,isTabbable:o,isActive:f,defaultListItem:m})}return m(i)};j=B(X,j);const Re=i.useCallback((e=>{const t=I.keyExtractor(e.target,M);n.isKeyDefined(t)&&(ie.current=t)}),[]),Pe=i.useCallback((e=>{" "===e.key&&r&&"none"!==F&&oe(!0)}),[r,F,oe]),je=i.useCallback((()=>{oe(!1)}),[oe]);return t.jsx("div",{...o.mergeProps(l?ye:{},ue,ge,Ae,Fe,{onFocus:pe,onPointerDown:Re,onKeyDown:Pe,onKeyUp:je},void 0!==U?U:{}),role:E,"aria-rowcount":re,"aria-colcount":1,ref:X,class:ce,tabIndex:0,"aria-label":e,"aria-labelledby":s,"aria-multiselectable":ae,children:null==c?d:L?t.jsx(R.VirtualizedCollection,{data:c,itemSelector:M,loadMoreIndicator:J,onLoadRange:g,rangeExtractor:x,suggestions:Ce,viewportConfig:j,children:Ve}):t.jsx(P.LoadMoreCollection,{data:c.data,loadMoreIndicator:J,hasMore:"atLeast"===c.sizePrecision&&c.data.length<=c.totalSize,onLoadMore:()=>{c&&g({offset:0,count:c.data.length+25})},suggestions:Ce,viewportConfig:j,children:Ve})})}}));
//# sourceMappingURL=List-b3266ee0.js.map
